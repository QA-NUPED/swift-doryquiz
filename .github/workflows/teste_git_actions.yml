name: Code Coverage

on: [push]

jobs:
  build:

    runs-on: macOS-latest

    steps:
    - name: Run tests
      uses: sersoft-gmbh/xcodebuild-action@v1
      with:
        project: MyApp.xcodeproj
        scheme: MyApp
        derived-data-path: ./output
        destination: "OS=14.4,name=iPhone 12 Pro"
        action: test
        enable-code-coverage: true

    - name: Test Coverage
      uses: maxep/xcodebuild-lcov-action@0.1.0
      with:
        derived-data-path: ./output
        target: MyApp.app
        output-file: ./output/lcov.info